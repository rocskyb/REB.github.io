"use strict";!function(){function e(){this.exclusionTags=["script","noscript","link","style","meta"],this.windowWidth=window.innerWidth||document.documentElement.clientWidth||0,this.windowHeight=window.innerHeight||document.body.clientHeight||0,this.indexedElements=[],this.isScrollStop=!0,this.scrollStopTime=new Date,this.scrollStartTime=0,"production"==window.environment?this.dbName="production_squadbeyond":this.dbName="development_squadbeyond",this.exitVisibilityChange="",null!=document.hidden?this.exitVisibilityChange="visibilitychange":null!=document.mozHidden?this.exitVisibilityChange="mozvisibilitychange":null!=document.msHidden?this.exitVisibilityChange="msvisibilitychange":null!=document.webkitHidden&&(this.exitVisibilityChange="webkitvisibilitychange"),this.lambdaApi="https://hd4wr2if8b.execute-api.ap-northeast-1.amazonaws.com/default/squadbeyond_bigquery_api_02",this.maxArrivalPosition=0,this.arrivalIndexes=[],this.widgetList=[],this.viewedWidgetClassnameList=[]}e.prototype={getBqApi:function(e,t){if("production"!=window.environment)return;const i=new URI("https://bq-api.squadbeyond.com/articles/actions");i.setSearch("table",e),i.setSearch("articleUid",window.article_uid),i.setSearch("environment",window.environment),i.setSearch("visitor_id",window.sb_tu_id),t.url=window.article_url,t.article_uid=window.article_uid,t.visitor_global_id=window.sb_global_id,t.visitor_id=window.sb_tu_id,t.window_width=this.windowWidth,t.window_height=this.windowHeight,t.user_agent=navigator.userAgent,i.setSearch("rows",encodeURIComponent(JSON.stringify(t)));const n=new XMLHttpRequest;n.open("GET",i.toString(),!0),n.send(null)},assignIndexAttribute:function(){let e=this,t=document.body.querySelector(".article-body");t.dataset.sbhi=3;const i=t.querySelectorAll("*"),n=Array.prototype.slice.call(i,0);n.forEach(function(t,i){if(i+=4,t.classList.contains("sb-fixed"))return;let n=t.tagName.toLowerCase();if(-1==e.exclusionTags.indexOf(n))if("fixed"!==getComputedStyle(t,null).position)t.dataset.sbhi=i;else{const e=t.querySelectorAll("*"),i=Array.prototype.slice.call(e,0);i.forEach(function(e){e.classList.add("sb-fixed")})}});const o=document.querySelectorAll("[data-sbhi]");this.indexedElements=Array.prototype.slice.call(o,0)},fetchWidgetList:function(){const e=document.querySelectorAll("[id^='sb-part-'], [data-sb-part-id]");this.widgetList=Array.prototype.slice.call(e,0)},assignCursorPointer:function(){let e;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(document.body.style.cursor="pointer")},assignParameterToLink:function(){const e=new URI(location.href);e.removeQuery("sbrd"),e.removeQuery("sb_tu_id"),e.removeQuery("step_uid");const t=e.query(!0),i=JSON.parse(document.querySelector(".js-asp-session").dataset.value),n=document.body.querySelectorAll("a[href^=http"),o=Array.prototype.slice.call(n,0);o.forEach(function(n){if(n.href.includes("tel:"))return;const o=new URI(n.href);if(o.addQuery(t),o.removeQuery("squadbeyond_uid"),o.addQuery("squadbeyond_uid",window.sb_tu_id),o.removeQuery("sb_article_uid"),o.addQuery("sb_article_uid",window.article_uid),n.href=o.toString(),i.session_id){const e=new URI(n.href);e.removeQuery(i.session_id),e.addQuery(i.session_id,window.sb_tu_id),n.href=e.toString()}const s=null!=n.href.match(/\/redirect_pages\//);if(s){const e=new URI(n.href);e.removeQuery("article_url"),e.addQuery("article_url",window.article_url),n.href=e.toString()}n.addEventListener("click",function(t){try{e.removeQuery("sb_article_uid"),e.addQuery("sb_article_uid",window.article_uid),e.removeQuery("sb_tu_id"),e.addQuery("sb_tu_id",window.sb_tu_id),history.replaceState(null,null,e.toString())}catch(i){}})})},isAnyPartOfElementInViewport:function(e){let t=e.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth,o=t.top<=i&&t.top+t.height>=0,s=t.left<=n&&t.left+t.width>=0;return o&&s},fetchElementInViewport:function(e){let t=this,i=null,n=0,o=window.pageYOffset!==undefined?window.pageYOffset:document.documentElement.scrollTop;switch(e){case"center":i=document.elementFromPoint(this.windowWidth/2,this.windowHeight/2);let t=this.windowHeight/2;n=o+t;break;case"bottom":i=document.elementFromPoint(this.windowWidth/2,this.windowHeight-1),n=o+this.windowHeight}if(null!=i&&i.dataset.sbhi)return i;let s=0,r=null;return this.indexedElements.forEach(function(e){if(t.isAnyPartOfElementInViewport(e)){let t=e.getBoundingClientRect(),i=Math.abs(n-(t.top+o));s>i&&(r=e),s=i}}),r},renderArrivalImage:function(){let e=this.fetchElementInViewport("bottom");if(!e)return;const t=e.dataset.sbhi;let i=window.pageYOffset!==undefined?window.pageYOffset:document.documentElement.scrollTop,n=e.getBoundingClientRect(),o=i+n.top,s=i+this.windowHeight-o,r=Math.floor(s/n.height*100);const d=i+this.windowHeight;this.maxArrivalPosition<d&&!this.arrivalIndexes.includes(t)&&(this.getBqApi("visitor_arrivals",{index:t,y_percent:r}),this.arrivalIndexes.push(t),this.maxArrivalPosition=d)},renderVisibleWidget:function(){try{let t=this;this.widgetList.forEach(function(e){const i=e.getAttribute("id")||`sb-part-${e.dataset.sbPartId}`||"",n=i.match(/^sb\-part\-(.*)$/),o=t.isAnyPartOfElementInViewport(e),s=e.className;n&&o&&!t.viewedWidgetClassnameList.includes(s)&&(t.getBqApi("widget_vimp_logs",{widget_id:i}),t.viewedWidgetClassnameList.push(s))})}catch(e){}},renderAttentionImage:function(){if(0===this.scrollStopTime)return;const e=(this.scrollStartTime.getTime()-this.scrollStopTime.getTime())/1e3;if(e<1)return;let t=Math.round((this.scrollStartTime.getTime()-this.scrollStopTime.getTime())/1e3),i=this.fetchElementInViewport("center");if(!i)return;let n=window.pageYOffset!==undefined?window.pageYOffset:document.documentElement.scrollTop,o=i.getBoundingClientRect(),s=Math.floor(n+o.top),r=n+this.windowHeight/2,d=Math.floor((r-s)/o.height*100);this.getBqApi("visitor_attentions",{index:i.dataset.sbhi,y_percent:d,second:t})},renderScrollImages:function(){let e=this,t;window.addEventListener("scroll",function(i){window.clearTimeout(t),e.isScrollStop=!1,e.scrollStartTime=new Date,e.renderAttentionImage(),e.scrollStopTime=0,t=setTimeout(function(){e.renderArrivalImage(),e.renderVisibleWidget(),e.isScrollStop=!0,e.scrollStopTime=new Date,e.scrollStartTime=0},200)},!1)},getTouchPosition:function(e){let t=undefined,i=undefined;if(e.changedTouches&&e.changedTouches[0]){let n=e.changedTouches[0];t=n.pageX,i=n.pageY}else e.originalEvent&&e.originalEvent.touches?(t=e.originalEvent.touches[0].pageX,i=e.originalEvent.touches[0].pageY):(t=e.pageX,i=e.pageY);return{x:t,y:i}},renderClickImage:function(){let e=this;document.body.addEventListener("click",function(t){let i="",n=null,o=null,s=t.target;for(;s&&"BODY"!==s.tagName;){const e=s.tagName;e&&"A"===e&&""===i?(i=s.href||"",n=s.dataset.sbhi||null,o=s.dataset.sbTracking||null):e&&"BUTTON"===e&&"submit"===s.getAttribute("type")&&""===i&&(o=s.dataset.sbTracking||null),s=s.parentNode}let r=e.getTouchPosition(t),d=t.target.getBoundingClientRect(),a=d.left+window.pageXOffset,l=d.top+window.pageYOffset,c=r.x-a,u=r.y-l,h=(c/d.width*100).toFixed(1),g=(u/d.height*100).toFixed(1);e.getBqApi("visitor_clicks",{index:t.target.dataset.sbhi,x_percent:h,y_percent:g,link:i,anchor_tag_index:n,is_tracking:o})})},getCookie:function(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2]},sendFbParams:function(){if("production"!=window.environment)return;const e=this.getCookie("_fbc")||"",t=this.getCookie("_fbp")||"",i=""!=e||""!=t;if(!i)return;const n={visitor_id:window.sb_tu_id,fbc:e,fbp:t},o=new URI("https://bq-api.squadbeyond.com/tables/visitor_facebook_parameters/records");o.setSearch("row",encodeURIComponent(JSON.stringify(n)));const s=new XMLHttpRequest;s.open("GET",o.toString(),!0),s.send(null)}};let t=new e;t.assignIndexAttribute(),t.assignCursorPointer(),t.assignParameterToLink(),t.renderArrivalImage(),t.renderScrollImages(),t.renderClickImage(),t.sendFbParams(),t.fetchWidgetList(),t.renderVisibleWidget()}();